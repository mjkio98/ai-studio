{% extends "base.html" %}

{% block content %}
        <!-- Main Content Container -->
        <div class="container-fluid py-4">
            <div class="row">
                <div class="col-12">
                    <div class="youtube-content-wrapper">
                        <div class="container">
                            <!-- Header -->
                            <header class="text-center mb-4">
                                <h1 id="main-title" class="display-6 font-weight-bold mb-3">
                                    <i class="fas fa-robot text-primary me-2"></i>
                                    <span id="title-text" data-en="AI Studio" data-ar="ÿßÿ≥ÿ™ŸàÿØŸäŸà ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä">AI Studio</span>
                                </h1>
                                <p id="subtitle-text" class="text-muted lead" data-en="AI-powered content analysis and summarization" data-ar="ÿ™ÿ≠ŸÑŸäŸÑ Ÿàÿ™ŸÑÿÆŸäÿµ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä">AI-powered content analysis and summarization</p>
                            </header>

                            <!-- Main Card Content -->
                            <div class="main-card">
                                <!-- URL Input Section -->
                                <div class="form-group">
                                    <div class="form-header">
                                        <label class="form-label">
                                            <span id="url-label" data-en="YouTube Video URLs" data-ar="ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÅŸäÿØŸäŸà">YouTube Video URLs</span>
                                        </label>
                                        <div class="mode-buttons">
                                            <button id="single-mode-btn" class="btn-mode active">
                                                <span id="single-mode-text" data-en="Video Summary" data-ar="ŸÖŸÑÿÆÿµ ÿßŸÑŸÅŸäÿØŸäŸà">Video Summary</span>
                                            </button>
                                            <button id="shorts-mode-btn" class="btn-mode hidden">
                                                <span id="shorts-mode-text" data-en="Shorts Generator" data-ar="ŸÖŸàŸÑÿØ ÿßŸÑÿ¥Ÿàÿ±ÿ™ÿ≥">Shorts Generator</span>
                                            </button>
                                            <button id="multi-mode-btn" class="btn-mode hidden">
                                                <span id="multi-mode-text" data-en="Multiple Videos" data-ar="ŸÅŸäÿØŸäŸàŸáÿßÿ™ ŸÖÿ™ÿπÿØÿØÿ©">Multiple Videos</span>
                                            </button>
                                            <button id="webpage-mode-btn" class="btn-mode">
                                                <span id="webpage-mode-text" data-en="Webpage Analysis" data-ar="ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©">Webpage Analysis</span>
                                            </button>
                                            <button id="chat-agent-mode-btn" class="btn-mode hidden">
                                                <span id="chat-agent-mode-text" data-en="Chat Agent" data-ar="ŸàŸÉŸäŸÑ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©">Chat Agent</span>
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Single Video Mode -->
                                    <div id="single-video-section" class="single-input-group">
                                        <input 
                                            type="url" 
                                            id="youtube-url" 
                                            placeholder="https://www.youtube.com/watch?v=..."
                                            data-en="https://www.youtube.com/watch?v=..."
                                            data-ar="https://www.youtube.com/watch?v=..."
                                            class="form-control form-control-lg"
                                        >
                                        <button 
                                            id="summarize-video-btn" 
                                            class="btn btn-primary btn-lg mt-3"
                                        >
                                            <i class="fas fa-magic me-2"></i>
                                            <span id="summarize-btn-text" data-en="Summarize Video" data-ar="ŸÑÿÆÿµ ÿßŸÑŸÅŸäÿØŸäŸà">Summarize Video</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Shorts Generator Mode -->
                                    <div id="shorts-generation-section" class="hidden">
                                        <div class="single-input-group">
                                            <input 
                                                type="url" 
                                                id="shorts-youtube-url" 
                                                placeholder="https://www.youtube.com/watch?v=..."
                                                data-en="https://www.youtube.com/watch?v=..."
                                                data-ar="https://www.youtube.com/watch?v=..."
                                                class="form-control form-control-lg"
                                            >
                                            <button 
                                                id="generate-shorts-btn" 
                                                class="btn btn-primary btn-lg mt-3"
                                            >
                                                <i class="fas fa-cut me-2"></i>
                                                <span id="generate-shorts-text" data-en="Generate Shorts" data-ar="ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¥Ÿàÿ±ÿ™ÿ≥">Generate Shorts</span>
                                            </button>
                                        </div>
                             
                                    </div>
                                    
                                    <!-- Multiple Videos Mode -->
                                    <div id="multi-video-section" class="hidden">
                                        <div class="input-container" id="url-inputs-container">
                                            <div class="input-row url-input-row mb-3">
                                                <input 
                                                    type="url" 
                                                    class="youtube-url-multi form-control"
                                                    placeholder="https://www.youtube.com/watch?v=... (Video 1)"
                                                    data-en="https://www.youtube.com/watch?v=... (Video 1)"
                                                    data-ar="https://www.youtube.com/watch?v=... (ŸÅŸäÿØŸäŸà 1)"
                                                >
                                                <button type="button" class="btn btn-outline-danger btn-sm ms-2 remove-url-btn" title="Remove URL">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                            <div class="input-row url-input-row mb-3">
                                                <input 
                                                    type="url" 
                                                    class="youtube-url-multi form-control"
                                                    placeholder="https://www.youtube.com/watch?v=... (Video 2)"
                                                    data-en="https://www.youtube.com/watch?v=... (Video 2)"
                                                    data-ar="https://www.youtube.com/watch?v=... (ŸÅŸäÿØŸäŸà 2)"
                                                >
                                                <button type="button" class="btn btn-outline-danger btn-sm ms-2 remove-url-btn" title="Remove URL">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="multi-actions mt-3">
                                            <button id="add-url-btn" class="btn btn-outline-primary me-2">
                                                <i class="fas fa-plus me-2"></i>
                                                <span id="add-url-text" data-en="Add Another URL" data-ar="ÿ£ÿ∂ŸÅ ÿ±ÿßÿ®ÿ∑ ÿ¢ÿÆÿ±">Add Another URL</span>
                                            </button>
                                            <button 
                                                id="summarize-multi-btn" 
                                                class="btn btn-primary btn-lg"
                                            >
                                                <i class="fas fa-layer-group me-2"></i>
                                                <span id="summarize-multi-text" data-en="Compare & Summarize" data-ar="ŸÇÿßÿ±ŸÜ ŸàŸÑÿÆÿµ">Compare & Summarize</span>
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Webpage Analysis Mode -->
                                    <div id="webpage-section" class="hidden">
                                        <div class="single-input-group">
                                            <input 
                                                type="url" 
                                                id="webpage-url" 
                                                class="form-control form-control-lg"
                                                placeholder="https://example.com/article..." 
                                                data-en="https://example.com/article..." 
                                                data-ar="...ÿ±ÿßÿ®ÿ∑ ŸÖŸÇÿßŸÑ ÿ£Ÿà ÿµŸÅÿ≠ÿ©"
                                            >
                                            <button 
                                                id="analyze-webpage-btn" 
                                                class="btn btn-primary btn-lg mt-3"
                                            >
                                                <i class="fas fa-globe me-2"></i>
                                                <span id="analyze-webpage-text" data-en="Analyze Webpage" data-ar="ÿ≠ŸÑŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©">Analyze Webpage</span>
                                            </button>
                                        </div>
                                        <!-- Helpful tip -->
                                        <div class="mt-3">
                                            <div class="alert alert-info">
                                                <i class="fas fa-info-circle me-2"></i>
                                                <span id="webpage-tip" data-en="Works best with: News articles, blog posts, Wikipedia pages. Some sites (Amazon, social media) may block automated access." data-ar="ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ£ŸÅÿ∂ŸÑ ŸÖÿπ: ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™ ÿßŸÑÿ•ÿÆÿ®ÿßÿ±Ÿäÿ©ÿå ÿßŸÑŸÖÿØŸàŸÜÿßÿ™ÿå ŸàÿµŸÅÿ≠ÿßÿ™ ŸàŸäŸÉŸäÿ®ŸäÿØŸäÿß. ÿ®ÿπÿ∂ ÿßŸÑŸÖŸàÿßŸÇÿπ (ÿ£ŸÖÿßÿ≤ŸàŸÜÿå Ÿàÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ™ŸàÿßÿµŸÑ) ŸÇÿØ ÿ™ŸÖŸÜÿπ ÿßŸÑŸàÿµŸàŸÑ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä.">Works best with: News articles, blog posts, Wikipedia pages. Some sites (Amazon, social media) may block automated access.</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Chat Agent Mode -->
                                    {% include 'components/chat_agent.html' %}
                                </div>

                                <!-- Status Messages -->
                                <div id="status-container" class="hidden mt-4">
                                    <!-- Loading State -->
                                    <div id="loading-state" class="alert alert-info">
                                        <div class="d-flex align-items-center">
                                            <div class="spinner-border spinner-border-sm me-3" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <div class="flex-grow-1">
                                                <span id="loading-text" data-en="Processing video..." data-ar="ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà...">Processing video...</span>
                                            </div>
                                            <button 
                                                id="cancel-btn" 
                                                class="btn btn-outline-secondary btn-sm hidden"
                                                title="Cancel current operation"
                                                data-en="Cancel" data-ar="ÿ•ŸÑÿ∫ÿßÿ°">
                                                Cancel
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Error State -->
                                    <div id="error-state" class="hidden alert alert-danger">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-exclamation-triangle me-3 mt-1"></i>
                                            <div class="flex-grow-1">
                                                <h6 class="alert-heading" data-en="Error" data-ar="ÿÆÿ∑ÿ£">Error</h6>
                                                <p class="mb-0" id="error-message"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Video Info (shown after processing) -->
                                <div id="video-info" class="hidden mt-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row align-items-center">
                                                <div class="col-auto">
                                                    <img id="video-thumbnail" class="rounded" style="width: 120px; height: 90px; object-fit: cover;" alt="Video thumbnail">
                                                </div>
                                                <div class="col">
                                                    <h5 id="video-title" class="card-title mb-2"></h5>
                                                    <p id="video-channel" class="card-text text-muted mb-2"></p>
                                                    <div class="video-meta">
                                                        <span class="badge bg-gradient-primary">
                                                            <i class="fas fa-robot me-1"></i>
                                                            <span data-en="Summarized with GPT" data-ar="ŸÖŸÑÿÆÿµ ÿ®Ÿàÿßÿ≥ÿ∑ÿ© GPT">Summarized with GPT</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Summary Section -->
                                <div id="summary-section" class="hidden mt-4">
                                    <div class="card">
                                        <div class="card-header pb-0">
                                            <div class="d-flex align-items-center justify-content-between">
                                                <h4 class="mb-0" id="summary-title" data-en="Summary" data-ar="ÿßŸÑŸÖŸÑÿÆÿµ">Summary</h4>
                                                <button id="copy-summary-btn" class="btn btn-outline-primary btn-sm" title="Copy summary to clipboard">
                                                    <i class="fas fa-copy me-1"></i>
                                                    <span id="copy-btn-text" data-en="Copy Summary" data-ar="ŸÜÿ≥ÿÆ ÿßŸÑŸÖŸÑÿÆÿµ">Copy Summary</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div id="summary-text" class="summary-text">
                                                <div class="text-center py-5 text-muted">
                                                    <i class="fas fa-magic display-4 mb-3"></i>
                                                    <p data-en="Summary will appear here..." data-ar="ÿ≥Ÿäÿ∏Ÿáÿ± ÿßŸÑŸÖŸÑÿÆÿµ ŸáŸÜÿß...">Summary will appear here...</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <div class="text-center">
                                                <span class="badge bg-gradient-info">
                                                    <i class="fas fa-robot me-1"></i>
                                                    <span data-en="Powered by GPT" data-ar="ŸÖÿØÿπŸàŸÖ ÿ®ŸÄ GPT">Powered by GPT</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Shorts Clips Section -->
                                <div id="shorts-clips-section" class="hidden mt-4">
                                    <div class="card">
                                        <div class="card-header pb-0">
                                            <div class="d-flex align-items-center justify-content-between mb-3">
                                                <h4 class="mb-0" id="clips-title" data-en="Generated Shorts" data-ar="ÿßŸÑÿ¥Ÿàÿ±ÿ™ÿ≥ ÿßŸÑŸÖŸèŸàŸÑÿØÿ©">Generated Shorts</h4>
                                                <div class="clips-count">
                                                    <span class="badge bg-gradient-primary" id="clips-count-badge">
                                                        <i class="fas fa-video me-1"></i>
                                                        <span id="clips-count-text">0 clips</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <!-- View Toggle -->
                                            <div class="view-toggle">
                                                <button id="grid-view-btn" class="btn btn-sm active" onclick="youtubeApp.switchToGridView()">
                                                    <i class="fas fa-th me-1"></i>
                                                    <span data-en="Grid" data-ar="ÿ¥ÿ®ŸÉÿ©">Grid</span>
                                                </button>
                                                <button id="list-view-btn" class="btn btn-sm" onclick="youtubeApp.switchToListView()">
                                                    <i class="fas fa-list me-1"></i>
                                                    <span data-en="List" data-ar="ŸÇÿßÿ¶ŸÖÿ©">List</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div id="shorts-clips-container">
                                                <div class="text-center py-5 text-muted">
                                                    <i class="fas fa-cut display-4 mb-3"></i>
                                                    <p data-en="Generated clips will appear here..." data-ar="ÿ≥ÿ™ÿ∏Ÿáÿ± ÿßŸÑŸÖŸÇÿßÿ∑ÿπ ÿßŸÑŸÖŸèŸàŸÑÿØÿ© ŸáŸÜÿß...">Generated clips will appear here...</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <div class="text-center">
                                                <span class="badge bg-gradient-info">
                                                    <i class="fas fa-scissors me-1"></i>
                                                    <span data-en="Powered by AI + MoviePy" data-ar="ŸÖÿØÿπŸàŸÖ ÿ®ŸÄ AI + MoviePy">Powered by AI + MoviePy</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
{{ super() }}
<script>
    // Initialize Client-Side Shorts Generator
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üé¨ Initializing client-side shorts generator...');
        
        // Check if client-side processing mixins are available
        if (window.YouTubeTranscriptAppMixins && window.YouTubeTranscriptAppMixins.length > 0) {
            console.log('‚úÖ Client-side processing modules loaded:', window.YouTubeTranscriptAppMixins.length);
            
            // Find the client shorts integration mixin
            const clientShortsIntegration = window.YouTubeTranscriptAppMixins.find(
                mixin => typeof mixin.initializeClientSideProcessing === 'function'
            );
            
            if (clientShortsIntegration) {
                // Make it globally accessible
                window.clientSideShortsIntegration = clientShortsIntegration;
                
                // Create youtubeApp object for backward compatibility with card HTML
                window.youtubeApp = {
                    playClientClip: (clipId, clipNum) => {
                        return clientShortsIntegration.playClientClip(clipId, clipNum);
                    },
                    downloadClientClip: (clipId) => {
                        return clientShortsIntegration.downloadClientClip(clipId);
                    }
                };
                
                // Initialize it
                clientShortsIntegration.initializeClientSideProcessing()
                    .then(() => {
                        console.log('‚úÖ Client-side shorts generator ready!');
                        
                        // IMPORTANT: Hook up the Generate Shorts button to use CLIENT-SIDE processing
                        const generateBtn = document.getElementById('generate-shorts-btn');
                        if (generateBtn) {
                            // Remove any existing click handlers
                            const newBtn = generateBtn.cloneNode(true);
                            generateBtn.parentNode.replaceChild(newBtn, generateBtn);
                            
                            // Add new client-side handler
                            newBtn.addEventListener('click', function(e) {
                                e.preventDefault();
                                console.log('üé¨ Generate Shorts button clicked - using CLIENT-SIDE processing');
                                clientShortsIntegration.generateShortsClientSide();
                            });
                            
                            console.log('‚úÖ Generate Shorts button connected to CLIENT-SIDE processing');
                        }
                        
                        // Also handle Enter key in URL input
                        const urlInput = document.getElementById('shorts-youtube-url');
                        if (urlInput) {
                            urlInput.addEventListener('keypress', function(e) {
                                if (e.key === 'Enter') {
                                    e.preventDefault();
                                    console.log('üé¨ Enter pressed - using CLIENT-SIDE processing');
                                    clientShortsIntegration.generateShortsClientSide();
                                }
                            });
                        }
                    })
                    .catch(error => {
                        console.error('‚ùå Failed to initialize:', error);
                    });
            } else {
                console.warn('‚ö†Ô∏è Client shorts integration mixin not found');
            }
        } else {
            console.warn('‚ö†Ô∏è Client-side processing not available - using server-side fallback');
            console.log('Available modules:', window.YouTubeTranscriptAppMixins);
        }
    });
</script>
{% endblock %}