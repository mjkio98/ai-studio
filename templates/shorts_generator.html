{% extends "base.html" %}

{% block nav_shorts_generator_active %}active bg-gradient-primary{% endblock %}

{% block breadcrumb %}
<span data-en="Shorts Generator" data-ar="ŸÖŸàŸÑÿØ ÿßŸÑÿ¥Ÿàÿ±ÿ™ÿ≥">Shorts Generator</span>
{% endblock %}

{% block page_title %}
<span data-en="AI-Powered Shorts Generator" data-ar="ŸÖŸàŸÑÿØ ÿßŸÑÿ¥Ÿàÿ±ÿ™ÿ≥ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä">AI-Powered Shorts Generator</span>
{% endblock %}

{% block content %}
        <!-- Main Content Container -->
        <div class="container-fluid py-4">
            <div class="row">
                <div class="col-12">
                    <div class="youtube-content-wrapper">
                        <div class="container">
                            <!-- Header -->
                            <header class="text-center mb-4">
                                <h1 id="main-title" class="display-6 font-weight-bold mb-3">
                                    <i class="fas fa-cut text-primary me-2"></i>
                                    <span id="title-text" data-en="AI Shorts Generator" data-ar="ŸÖŸàŸÑÿØ ÿßŸÑÿ¥Ÿàÿ±ÿ™ÿ≥ ÿ®ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä">AI Shorts Generator</span>
                                </h1>
                                <p id="subtitle-text" class="text-muted lead" data-en="Transform long videos into engaging short clips" data-ar="ÿ≠ŸàŸÑ ÿßŸÑŸÅŸäÿØŸäŸàŸáÿßÿ™ ÿßŸÑÿ∑ŸàŸäŸÑÿ© ÿ•ŸÑŸâ ŸÖŸÇÿßÿ∑ÿπ ŸÇÿµŸäÿ±ÿ© ÿ¨ÿ∞ÿßÿ®ÿ©">Transform long videos into engaging short clips</p>
                            </header>

                            <!-- Main Card Content -->
                            <div class="main-card">
                                <!-- URL Input Section -->
                                <div class="form-group">
                                    <div class="form-header">
                                        <label class="form-label">
                                            <span id="url-label" data-en="YouTube Video URL" data-ar="ÿ±ÿßÿ®ÿ∑ ŸÅŸäÿØŸäŸà ŸäŸàÿ™ŸäŸàÿ®">YouTube Video URL</span>
                                        </label>
                                    </div>
                                    
                                    <!-- Shorts Generator Mode -->
                                    <div id="shorts-generation-section" class="single-input-group">
                                        <input 
                                            type="url" 
                                            id="shorts-youtube-url" 
                                            placeholder="https://www.youtube.com/watch?v=..."
                                            data-en="https://www.youtube.com/watch?v=..."
                                            data-ar="https://www.youtube.com/watch?v=..."
                                            class="form-control form-control-lg"
                                        >
                                        <button 
                                            id="generate-shorts-btn" 
                                            class="btn btn-primary btn-lg mt-3"
                                        >
                                            <i class="fas fa-cut me-2"></i>
                                            <span id="generate-shorts-text" data-en="Generate Shorts" data-ar="ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ¥Ÿàÿ±ÿ™ÿ≥">Generate Shorts</span>
                                        </button>
                                    </div>
                                </div>

                                <!-- Status Messages -->
                                <div id="status-container" class="hidden mt-4">
                                    <!-- Loading State -->
                                    <div id="loading-state" class="alert alert-info">
                                        <div class="d-flex align-items-center">
                                            <div class="spinner-border spinner-border-sm me-3" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <div class="flex-grow-1">
                                                <span id="loading-text" data-en="Processing video..." data-ar="ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÅŸäÿØŸäŸà...">Processing video...</span>
                                            </div>
                                            <button 
                                                id="cancel-btn" 
                                                class="btn btn-outline-secondary btn-sm hidden"
                                                title="Cancel current operation"
                                                data-en="Cancel" data-ar="ÿ•ŸÑÿ∫ÿßÿ°">
                                                Cancel
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Error State -->
                                    <div id="error-state" class="hidden alert alert-danger">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-exclamation-triangle me-3 mt-1"></i>
                                            <div class="flex-grow-1">
                                                <h6 class="alert-heading" data-en="Error" data-ar="ÿÆÿ∑ÿ£">Error</h6>
                                                <p class="mb-0" id="error-message"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Video Info (shown after processing) -->
                                <div id="video-info" class="hidden mt-4">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="row align-items-center">
                                                <div class="col-auto">
                                                    <img id="video-thumbnail" class="rounded" style="width: 120px; height: 90px; object-fit: cover;" alt="Video thumbnail">
                                                </div>
                                                <div class="col">
                                                    <h5 id="video-title" class="card-title mb-2"></h5>
                                                    <p id="video-channel" class="card-text text-muted mb-2"></p>
                                                    <div class="video-meta">
                                                        <span class="badge bg-gradient-primary">
                                                            <i class="fas fa-cut me-1"></i>
                                                            <span data-en="Processed for Shorts" data-ar="ŸÖÿπÿßŸÑÿ¨ ŸÑŸÑÿ¥Ÿàÿ±ÿ™ÿ≥">Processed for Shorts</span>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Shorts Clips Section -->
                                <div id="shorts-clips-section" class="hidden mt-4">
                                    <div class="card">
                                        <div class="card-header pb-0">
                                            <div class="d-flex align-items-center justify-content-between mb-3">
                                                <h4 class="mb-0" id="clips-title" data-en="Generated Shorts" data-ar="ÿßŸÑÿ¥Ÿàÿ±ÿ™ÿ≥ ÿßŸÑŸÖŸèŸàŸÑÿØÿ©">Generated Shorts</h4>
                                                <div class="clips-count">
                                                    <span class="badge bg-gradient-primary" id="clips-count-badge">
                                                        <i class="fas fa-video me-1"></i>
                                                        <span id="clips-count-text">0 clips</span>
                                                    </span>
                                                </div>
                                            </div>
                                            <!-- View Toggle -->
                                            <div class="view-toggle">
                                                <button id="grid-view-btn" class="btn btn-sm active" onclick="switchToGridView()">
                                                    <i class="fas fa-th me-1"></i>
                                                    <span data-en="Grid" data-ar="ÿ¥ÿ®ŸÉÿ©">Grid</span>
                                                </button>
                                                <button id="list-view-btn" class="btn btn-sm" onclick="switchToListView()">
                                                    <i class="fas fa-list me-1"></i>
                                                    <span data-en="List" data-ar="ŸÇÿßÿ¶ŸÖÿ©">List</span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div id="shorts-clips-container">
                                                <div class="text-center py-5 text-muted">
                                                    <i class="fas fa-cut display-4 mb-3"></i>
                                                    <p data-en="Generated clips will appear here..." data-ar="ÿ≥ÿ™ÿ∏Ÿáÿ± ÿßŸÑŸÖŸÇÿßÿ∑ÿπ ÿßŸÑŸÖŸèŸàŸÑÿØÿ© ŸáŸÜÿß...">Generated clips will appear here...</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <div class="text-center">
                                                <span class="badge bg-gradient-info">
                                                    <i class="fas fa-scissors me-1"></i>
                                                    <span data-en="Powered by AI + MoviePy" data-ar="ŸÖÿØÿπŸàŸÖ ÿ®ŸÄ AI + MoviePy">Powered by AI + MoviePy</span>
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

                {% block javascript %}
        {{ super() }}
        <!-- Scripts already loaded by base template, no need to reload -->
        
        <script>
        // Initialize Language System (using existing language manager mixin)
        document.addEventListener('DOMContentLoaded', function() {
            // Find the language manager mixin
            if (window.YouTubeTranscriptAppMixins && window.YouTubeTranscriptAppMixins.length > 0) {
                const languageManager = window.YouTubeTranscriptAppMixins.find(
                    mixin => typeof mixin.initializeLanguageSystem === 'function'
                );
                
                if (languageManager) {
                    // Initialize the language system
                    languageManager.initializeLanguageSystem();
                    console.log('‚úÖ Language system initialized');
                } else {
                    console.warn('‚ö†Ô∏è Language manager mixin not found');
                }
            }
        });
        
        // View switching functions
        function switchToGridView() {
            const container = document.getElementById('shorts-clips-container');
            const gridBtn = document.getElementById('grid-view-btn');
            const listBtn = document.getElementById('list-view-btn');
            
            if (container) {
                container.className = 'video-clips-grid';
                // Force display for mobile compatibility
                container.style.display = 'grid';
                container.style.width = '100%';
                container.style.visibility = 'visible';
                console.log('‚úÖ Grid view activated with mobile fixes');
            }
            
            if (gridBtn && listBtn) {
                gridBtn.classList.add('active');
                listBtn.classList.remove('active');
            }
        }
        
        function switchToListView() {
            const container = document.getElementById('shorts-clips-container');
            const gridBtn = document.getElementById('grid-view-btn');
            const listBtn = document.getElementById('list-view-btn');
            
            if (container) {
                container.className = 'video-clips-list';
                // Force display for mobile compatibility
                container.style.display = 'block';
                container.style.width = '100%';
                container.style.visibility = 'visible';
            }
            
            if (gridBtn && listBtn) {
                listBtn.classList.add('active');
                gridBtn.classList.remove('active');
            }
        }
        
        // Initialize grid view on page load for mobile compatibility
        document.addEventListener('DOMContentLoaded', function() {
            // Set default grid view
            switchToGridView();
            console.log('‚úÖ Default grid view initialized for mobile');
        });
        
        // Initialize Client-Side Shorts Generator (EXACT COPY FROM DASHBOARD)
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé¨ Initializing client-side shorts generator...');
            
            // Check if client-side processing mixins are available
            if (window.YouTubeTranscriptAppMixins && window.YouTubeTranscriptAppMixins.length > 0) {
                console.log('‚úÖ Client-side processing modules loaded:', window.YouTubeTranscriptAppMixins.length);
                
                // Find the client shorts integration mixin
                const clientShortsIntegration = window.YouTubeTranscriptAppMixins.find(
                    mixin => typeof mixin.initializeClientSideProcessing === 'function'
                );
                
                if (clientShortsIntegration) {
                    // Make it globally accessible
                    window.clientSideShortsIntegration = clientShortsIntegration;
                    
                    // Create youtubeApp object for backward compatibility with card HTML
                    window.youtubeApp = {
                        playClientClip: (clipId, clipNum) => {
                            return clientShortsIntegration.playClientClip(clipId, clipNum);
                        },
                        downloadClientClip: (clipId) => {
                            return clientShortsIntegration.downloadClientClip(clipId);
                        },
                        switchToGridView: switchToGridView,
                        switchToListView: switchToListView
                    };
                    
                    // Initialize it
                    clientShortsIntegration.initializeClientSideProcessing()
                        .then(() => {
                            console.log('‚úÖ Client-side shorts generator ready!');
                            
                            // IMPORTANT: Hook up the Generate Shorts button to use CLIENT-SIDE processing
                            const generateBtn = document.getElementById('generate-shorts-btn');
                            if (generateBtn) {
                                // Remove any existing click handlers
                                const newBtn = generateBtn.cloneNode(true);
                                generateBtn.parentNode.replaceChild(newBtn, generateBtn);
                                
                                // Add new client-side handler
                                newBtn.addEventListener('click', function(e) {
                                    e.preventDefault();
                                    console.log('üé¨ Generate Shorts button clicked - using CLIENT-SIDE processing');
                                    clientShortsIntegration.generateShortsClientSide();
                                });
                                
                                console.log('‚úÖ Generate Shorts button connected to CLIENT-SIDE processing');
                            }
                            
                            // Also handle Enter key in URL input
                            const urlInput = document.getElementById('shorts-youtube-url');
                            if (urlInput) {
                                urlInput.addEventListener('keypress', function(e) {
                                    if (e.key === 'Enter') {
                                        e.preventDefault();
                                        console.log('üé¨ Enter pressed - using CLIENT-SIDE processing');
                                        clientShortsIntegration.generateShortsClientSide();
                                    }
                                });
                            }
                        })
                        .catch(error => {
                            console.error('‚ùå Failed to initialize:', error);
                        });
                } else {
                    console.warn('‚ö†Ô∏è Client shorts integration mixin not found');
                }
            } else {
                console.warn('‚ö†Ô∏è Client-side processing not available - using server-side fallback');
                console.log('Available modules:', window.YouTubeTranscriptAppMixins);
            }
        });
        </script>
        {% endblock %}
{% endblock %}